<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>دانلود از یوتیوب</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #121212;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    h1 {
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 10px;
      margin: 10px;
      font-size: 16px;
      border-radius: 5px;
      width: 80%;
      max-width: 400px;
    }
    button {
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    #qualitySection, #playlistSection {
      display: none;
    }
    .container {
      text-align: center;
      margin-top: 20px;
    }
    .info {
      background-color: #333;
      padding: 10px;
      margin: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>ابزار دانلود از یوتیوب</h1>

  <div class="container">
    <input type="text" id="videoUrl" placeholder="لینک ویدیو یوتیوب" />
    <button onclick="fetchVideoData()">استخراج کیفیت‌ها</button>

    <div id="formatsSection">
      <h3>انتخاب کیفیت و فرمت:</h3>
      <select id="qualitySelect">
        <option value="">کیفیت انتخاب کنید</option>
      </select>
      <button onclick="downloadVideo()">دانلود ویدیو</button>
      <button onclick="downloadAudio()">دانلود صدا (MP3)</button>
    </div>

    <div id="playlistSection">
      <h3>دانلود لیست پخش</h3>
      <button onclick="downloadPlaylist()">دانلود لیست پخش</button>
    </div>

    <div id="errorSection" style="display:none; color: red;">
      <p>لطفاً لینک معتبر وارد کنید!</p>
    </div>

    <div id="infoSection" class="info">
      <h4>اطلاعات ویدیو</h4>
      <p id="videoInfo"></p>
    </div>
  </div>

  <script>
    async function fetchVideoData() {
      const videoUrl = document.getElementById('videoUrl').value.trim();
      if (!videoUrl) {
        document.getElementById('errorSection').style.display = 'block';
        return;
      }
      document.getElementById('errorSection').style.display = 'none';

      const response = await fetch(`/api/formats?url=${videoUrl}`);
      const data = await response.json();

      if (data.formats) {
        const select = document.getElementById('qualitySelect');
        select.innerHTML = `<option value="">کیفیت انتخاب کنید</option>`; // Reset

        data.formats.forEach(format => {
          const option = document.createElement('option');
          option.value = format.itag;
          option.textContent = `${format.quality} - ${format.format}`;
          select.appendChild(option);
        });

        // Display video info
        const videoInfo = document.getElementById('videoInfo');
        videoInfo.innerHTML = `عنوان: ${data.title}<br>تاریخ آپلود: ${data.upload_date}`;
        
        // Show quality section
        document.getElementById('formatsSection').style.display = 'block';
      }
    }

    function downloadVideo() {
      const quality = document.getElementById('qualitySelect').value;
      const videoUrl = document.getElementById('videoUrl').value;
      if (!quality) {
        alert("لطفاً کیفیت را انتخاب کنید");
        return;
      }
      const downloadLink = `/download?url=${videoUrl}&quality=${quality}`;
      window.location.href = downloadLink;
    }

    function downloadAudio() {
      const videoUrl = document.getElementById('videoUrl').value;
      const downloadLink = `/download?url=${videoUrl}&audio=true`;
      window.location.href = downloadLink;
    }

    function downloadPlaylist() {
      const videoUrl = document.getElementById('videoUrl').value;
      const downloadLink = `/download?url=${videoUrl}&playlist=true`;
      window.location.href = downloadLink;
    }
  </script>
</body>
</html>
