<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>yt-dlp پیشرفته</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .card {
      margin-top: 20px;
      border-radius: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .btn-copy {
      position: absolute;
      top: 8px;
      right: 8px;
    }
    pre {
      background: #212529;
      color: #fff;
      padding: 10px;
      border-radius: .5rem;
      overflow-x: auto;
    }
  </style>
</head>
<body>
<div class="container py-4">
  <h1 class="text-center mb-4">ساخت دستور yt-dlp پیشرفته</h1>
  <div class="card p-4">
    <label for="url" class="form-label">لینک ویدیو یا پلی‌لیست:</label>
    <input type="text" class="form-control" id="url" placeholder="مثلاً https://www.youtube.com/watch?v=abc123"><label for="format" class="form-label mt-3">فرمت یا کیفیت دلخواه (مثلاً best، 137+140):</label>
<input type="text" class="form-control" id="format" placeholder="best یا 137+140 یا ...">

<div class="form-check mt-3">
  <input class="form-check-input" type="checkbox" value="" id="audioOnly">
  <label class="form-check-label" for="audioOnly">فقط صدا (mp3 یا m4a)</label>
</div>

<button onclick="generateCommand()" class="btn btn-primary mt-3">ساخت دستور</button>
<button onclick="fetchFormats()" class="btn btn-outline-secondary mt-3 ms-2">استخراج کیفیت‌ها</button>

<div class="position-relative mt-4">
  <button class="btn btn-sm btn-secondary btn-copy" onclick="copyCommand()">کپی</button>
  <pre id="output" class="mt-2">دستور اینجا نمایش داده می‌شود...</pre>
</div>

<div id="formats" class="mt-4"></div>

  </div>
</div><script>
function generateCommand() {
  const url = document.getElementById('url').value.trim();
  const format = document.getElementById('format').value.trim();
  const audio = document.getElementById('audioOnly').checked;

  if (!url) return alert('لینک را وارد کنید');

  let cmd = `yt-dlp `;
  if (audio) {
    cmd += `-x --audio-format mp3 `;
  }
  if (format) {
    cmd += `-f "${format}" `;
  }
  cmd += `"${url}"`;

  document.getElementById('output').innerText = cmd;
}

function copyCommand() {
  const text = document.getElementById('output').innerText;
  navigator.clipboard.writeText(text).then(() => alert('کپی شد'));
}

async function fetchFormats() {
  const url = document.getElementById('url').value.trim();
  if (!url) return alert('لینک را وارد کنید');

  document.getElementById('formats').innerHTML = 'در حال بارگذاری...';

  try {
    const res = await fetch("https://yt-dlp-api-h9nv.onrender.com/formats", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ url })
    });
    const data = await res.json();

    if (data.error) throw new Error(data.error);

    let html = '<h5 class="mt-3">فرمت‌های قابل استفاده:</h5><ul class="list-group">';
    for (const fmt of data.formats) {
      html += `<li class="list-group-item d-flex justify-content-between align-items-center">
        ${fmt.format_id} - ${fmt.ext} - ${fmt.resolution || fmt.abr || '---'}
        <span class="badge bg-info">${fmt.filesize ? (fmt.filesize / 1024 / 1024).toFixed(1) + ' MB' : '---'}</span>
      </li>`;
    }
    html += '</ul>';
    document.getElementById('formats').innerHTML = html;

  } catch (err) {
    document.getElementById('formats').innerHTML = `<div class="alert alert-danger mt-3">خطا در دریافت کیفیت‌ها: ${err.message}</div>`;
  }
}
</script></body>
</html>
